@page "/login"
@inject NavigationManager NavigationManager

<PageTitle>Přihlášení - Scio</PageTitle>

<div class="auth-container px-3 fade-in">
    <div class="auth-card glass-card">
        <div class="text-center mb-4">
            <div class="d-inline-flex align-items-center justify-content-center bg-primary text-white rounded-circle mb-3 shadow-sm" style="width: 60px; height: 60px;">
                <span class="bi bi-person-badge-fill h3 mb-0"></span>
            </div>
            <h1>Přihlášení</h1>
            <p>Vítejte zpět v chatu Scio</p>
        </div>

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="alert alert-danger border-0 rounded-3 small mb-4 fade-in">
                <span class="bi bi-x-circle-fill me-2"></span> @errorMessage
            </div>
        }

        @if (isRegistered)
        {
            <div class="alert bg-success-light text-success border-0 rounded-3 small mb-4 fade-in">
                <span class="bi bi-check-circle-fill me-2"></span> Registrace proběhla v pořádku. Přihlaste se.
            </div>
        }

        <form action="auth/login" method="post" class="mb-4">
            <div class="form-group mb-3">
                <label class="x-small fw-bold text-muted uppercase-title mb-1">Uživatelské jméno</label>
                <input id="login" name="login" type="text" class="form-control border-0 bg-light py-2" placeholder="např. jnovak" required />
            </div>

            <div class="form-group mb-4">
                <label class="x-small fw-bold text-muted uppercase-title mb-1">Heslo</label>
                <input id="password" name="password" type="password" class="form-control border-0 bg-light py-2" placeholder="********" required />
            </div>

            <button type="submit" class="btn btn-primary w-100 py-3 shadow-md fw-bold">
                Přihlásit se
            </button>
        </form>

        <div class="separator mb-4">
            <span class="px-3 x-small fw-bold text-muted uppercase-title">nebo</span>
        </div>

        <a href="auth/google-login" class="btn btn-white w-100 py-2 border rounded-3 d-flex align-items-center justify-content-center gap-2 shadow-sm mb-4">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" height="18" alt="G" />
            <span class="fw-bold small">Přihlásit se přes Google</span>
        </a>

        <div class="text-center mt-2">
            <span class="text-muted small">Nemáte účet?</span> 
            <a href="register" class="fw-bold text-primary small text-decoration-none ms-1">Vytvořit účet</a>
        </div>
    </div>
</div>

@code {
    private string? errorMessage;
    private bool isRegistered = false;

    protected override void OnInitialized()
    {
        var uri = new Uri(NavigationManager.Uri);
        var query = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);

        if (query.TryGetValue("error", out var error)) errorMessage = error;
        if (query.TryGetValue("registered", out var reg) && reg == "true") isRegistered = true;
    }
}

<style>
    .btn-white { background: white; color: var(--text-main); }
    .btn-white:hover { background: #f8fafc; color: var(--primary); }
    .bg-success-light { background-color: #f0fdf4 !important; }
</style>
