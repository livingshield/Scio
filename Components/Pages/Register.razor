@page "/register"
@using ScioApp.Services
@using ScioApp.Models
@inject IAuthService AuthService
@inject NavigationManager NavigationManager

<PageTitle>Registrace - Scio</PageTitle>

<div class="container min-vh-100 d-flex align-items-center justify-content-center py-5 fade-in">
    <div class="glass-card p-5 w-100" style="max-width: 480px;">
        <div class="text-center mb-5">
            <div class="bg-primary-custom rounded-pill d-inline-flex align-items-center justify-content-center mb-4 shadow-lg" style="width: 70px; height: 70px;">
                <span class="bi bi-person-plus text-white h2 mb-0"></span>
            </div>
            <h1 class="fw-bold h3">Vytvořit účet</h1>
            <p class="text-muted">Staňte se součástí komunity Scio</p>
        </div>

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="alert alert-danger border-0 small py-3 mb-4 rounded-3 d-flex gap-3">
                <span class="bi bi-exclamation-circle-fill fs-4 mt-1"></span>
                <div>
                   <div class="fw-bold">Chyba registrace</div>
                   <div class="opacity-75">@errorMessage</div>
                </div>
            </div>
        }

        <EditForm Model="@registerModel" OnValidSubmit="HandleRegister">
            <DataAnnotationsValidator />
            
            <div class="mb-3">
                <label class="form-label small fw-bold text-muted">CELÉ JMÉNO</label>
                <InputText @bind-Value="registerModel.Name" class="form-control form-control-custom" placeholder="Jan Novák" />
                <ValidationMessage For="@(() => registerModel.Name)" class="text-danger small mt-1" />
            </div>

            <div class="mb-3">
                <label class="form-label small fw-bold text-muted">EMAIL</label>
                <InputText @bind-Value="registerModel.Email" class="form-control form-control-custom" placeholder="jan.novak@skola.cz" />
                <ValidationMessage For="@(() => registerModel.Email)" class="text-danger small mt-1" />
            </div>

            <div class="mb-3">
                <label class="form-label small fw-bold text-muted">UŽIVATELSKÉ JMÉNO</label>
                <InputText @bind-Value="registerModel.Username" class="form-control form-control-custom" placeholder="jannovak" />
                <ValidationMessage For="@(() => registerModel.Username)" class="text-danger small mt-1" />
            </div>

            <div class="mb-4">
                <label class="form-label small fw-bold text-muted">HESLO</label>
                <InputText @bind-Value="registerModel.Password" type="password" class="form-control form-control-custom" placeholder="Minimálně 6 znaků" />
                <ValidationMessage For="@(() => registerModel.Password)" class="text-danger small mt-1" />
            </div>

            <button type="submit" class="btn btn-primary-custom w-100 py-3 mb-4" disabled="@isBusy">
                @if (isBusy)
                {
                    <span class="spinner-border spinner-border-sm me-2"></span>
                    <span>Probíhá registrace...</span>
                }
                else
                {
                    <span>Vytvořit účet</span>
                }
            </button>

            <div class="text-center">
                <p class="text-muted small">Již máte účet? <a href="login" class="text-primary fw-bold text-decoration-none">Přihlaste se</a></p>
            </div>
        </EditForm>
    </div>
</div>

<style>
    .bg-primary-custom { background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%); }
</style>

@code {
    private ScioApp.Models.RegisterRequest registerModel = new();
    private string errorMessage = "";
    private bool isBusy = false;

    private async Task HandleRegister()
    {
        isBusy = true;
        errorMessage = "";
        var result = await AuthService.RegisterTeacherAsync(registerModel.Username, registerModel.Email, registerModel.Name, registerModel.Password);
        if (result.Success) { NavigationManager.NavigateTo("login"); }
        else { errorMessage = result.Message; }
        isBusy = false;
    }
}
